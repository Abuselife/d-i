#! /bin/sh
#
# Copy install logs to /target/var/log/debian-installer

# Intentionally not set -e.

logsavedir=/target/var/log/debian-installer

# Make sure the debconf priority is in questions.dat for base-config.
# (Gross hack; there must be a better way.)
. /usr/share/debconf/confmodule
db_get debconf/priority
db_set debconf/priority $RET
# Make sure debconf has saved the database.
db_x_save

mkdir -p $logsavedir/cdebconf
cp /var/log/* $logsavedir
chmod 600 $logsavedir/*
chmod 755 $logsavedir/cdebconf # done this way for idempotency

# Copy current debconf database
cp -a /var/lib/cdebconf $logsavedir
chmod 600 $logsavedir/cdebconf/*
