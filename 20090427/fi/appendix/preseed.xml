<!-- Start of file appendix/preseed.xml -->
<!-- $Id: preseed.xml 58146 2009-04-05 23:13:35Z fjp $ -->

<!--
Be careful with the format of this file as it is parsed to generate
the example preconfiguration file.
In that file all text between <informalexample
> tags that have the
attribute 'role="example"' set is included, except if a 'condition'
attribute is in force that does not match the specified release or if an
'arch' attribute is in force that does not match the specified architecture.

Currently only a single variant of the example file is generated (for i386).
-->

<appendix id="appendix-preseed">
<title
>Asennuksen automatisointi valmiilla vastauksilla</title>

<para
>Tämä liite selittää miten debianin asentimen kysymyksiin annetaan valmiit vastaukset asennuksen automatisoimiseksi. </para
><para
>Tässä liitteessä käytetyt asetustiedostojen osat ovat saatavilla myös esimerkkiasetustiedostona &urlset-example-preseed;. </para>

 <sect1 id="preseed-intro">
 <title
>Johdanto</title>
<para
>Valmiit vastaukset tarkoittaa asennuksen aikana kysyttävien kysymysten vastauksien antamista etukäteen, jolloin asennuksen aikana ei tarvitse istua vastailemassa. Tämä mahdollistaa useimpien asennustapojen täydellisen automatisoinnin ja jopa muutamia lisäominaisuuksia joita ei tavallisessa asennuksessa ole. </para
><para
>Valmiit vastaukset eivät ole pakollisia. Jos käytetään tyhjää valmiiden vastausten tiedostoa, asennin toimii kuten normaalissa manuaalisessa asennuksessa. Jokainen ennalta annettu vastaus (jos valinta on oikea) muuttaa asennusta jollain tavalla normaalista. </para>

  <sect2 id="preseed-methods">
  <title
>Valmiiden vastausten tallennustapoja</title>
<para
>Valmiille vastauksille on kolme tallennuspaikkaa: <firstterm
>initrd</firstterm
>, <firstterm
>tiedosto</firstterm
> ja <firstterm
>verkko</firstterm
>. initrd toimii kaikilla asennustavoilla ja tukee valmiita vastauksia useampiin kysyttäviin asioihin, mutta vaatii eniten valmisteluja. Sekä tiedostoa että verkkoa voidaan käyttää eri asennustavoissa. </para
><para
>Seuraava taulukko näyttää mitä valmiiden vastausten tallennuspaikkoja voi käyttää minkäkinlaisissa asennustavoissa. <informaltable
> <tgroup cols="4">
<thead>
<row>
  <entry
>Asennustapa</entry
><entry
>initrd</entry>
  <entry
>tiedosto</entry
><entry
>verkko</entry>
</row>
</thead>

<tbody>
<row>
  <entry
>CD/DVD</entry>
  <entry
>kyllä</entry>
  <entry
>kyllä</entry>
  <entry
>kyllä<footnote id='apx-ps-net'
> <para
>mutta vain jos verkkoyhteys toimii ja muuttujalla <literal
>preseed/url</literal
> on sopiva arvo </para>

  </footnote
></entry>
</row
><row>
  <entry
>netboot</entry>
  <entry
>kyllä</entry>
  <entry
>ei</entry>
  <entry
>kyllä</entry>
</row
><row>
  <entry
>kiintolevy <phrase condition="bootable-usb"
>(myös USB-muisti)</phrase
></entry>
  <entry
>kyllä</entry>
  <entry
>kyllä</entry>
  <entry
>kyllä<footnoteref linkend='apx-ps-net'/></entry>
</row
><row condition="supports-floppy-boot">
  <entry
>levykkeeltä (CD-ajurit)</entry>
  <entry
>kyllä</entry>
  <entry
>kyllä</entry>
  <entry
>kyllä<footnoteref linkend='apx-ps-net'/></entry>
</row
><row condition="supports-floppy-boot">
  <entry
>levykkeeltä (verkkoajurit)</entry>
  <entry
>kyllä</entry>
  <entry
>ei</entry>
  <entry
>kyllä</entry>
</row
><row arch="s390">
  <entry
>muu/nauha</entry>
  <entry
>kyllä</entry>
  <entry
>ei</entry>
  <entry
>kyllä</entry>
</row>
</tbody>

</tgroup
></informaltable>

</para
><para
>Tärkeä ero valmiiden vastausten tallennuspaikkojen välillä on vastausten noutamis- ja käsittelyhetki asennuksen aikana. initrd on käytettävissä heti asennuksen alussa, ennen ensimmäistäkään kysymystä. Tiedostosta voidaan lukea kun CD tai CD-otos on ladattu. Verkosta voidaan noutaa vasta kun verkkoasetukset on tehty. </para
><para
>Ei tietenkään ole mahdollista antaa valmiita vastauksia kysymyksiin jotka esitetään ennen vastausten noutamista (näihin kysymyksiin kuuluvat ne, jotka näytetään vai prioriteetin ollessa keskitaso tai matala, esimerkiksi ensimmäinen laitteiston tunnistus). <xref linkend="preseed-bootparms"/> kertoo miten nämä kysymyksen on mahdollista välttää. </para
><para
>Kysymykset, jotka normaalisti kysytään ennen valmiiden vastauksien käyttöä, voidaan välttää käynnistämällä asennin tilaan <quote
>auto</quote
>. Tämä viivästää kysymyksiä, jotka normaalisti kysyttäisiin liian aikaisin valmiiden vastausten kannalta (ts. kieli, maa ja näppäimistön valinta), kunnes verkko toimii, jolloin valmiita vastauksia voidaan käyttää. Samalla asennin käyttää prioriteettia kriittinen, jolloin monia vähemmän tärkeitä kysymyksiä ohitetaan. Katso yksityiskohtaisempaa tietoa <xref linkend="preseed-auto"/>. </para>
  </sect2>

  <sect2 id="preseed-limitations">
  <title
>Rajoituksia</title>
<para
>Vaikkakin useimpiin asentimen kysymyksiin voidaan antaa valmiit vastaukset, on muutamia tärkeitä poikkeuksia. Kiintolevy on joko (uudelleen) osioitava kokonaan  tai käytettävä levyllä olevaa vapaata tilaa; ei ole mahdollista käyttää valmiita osioita. </para>
  </sect2>

<!-- Joeyh feels this is too technical, so leave it out for now
  <sect2 id="preseed-debconf">
  <title
>Debconf basics</title>
<para>

Preseeding makes use of the <classname
>debconf</classname
> framework. This
framework is the preferred mechanism used in Debian to interact with the user
when configuring packages and also forms the heart of &d-i;.
In the <classname
>debconf</classname
> framework questions or dialogs are
based on <firstterm
>templates</firstterm
>. There are different types of
templates for different types of questions. The actual questions are
<quote
>generated</quote
> from templates at runtime;  multiple questions can
use the same template.

</para
><para>

The following types of templates are relevant for preseeding.

</para>

<itemizedlist spacing="compact">
<listitem
><para>
  string: allows the user to type any value
</para
></listitem>
<listitem
><para>
  password: similar to string but the value typed is not displayed
</para
></listitem>
<listitem
><para>
  boolean: for yes/no or true/false type of questions
</para
></listitem>
<listitem
><para>
  select: allows the user to select one option from a list
</para
></listitem>
<listitem
><para>
  multiselect: allows the user to select zero, one or more options from a list
</para
></listitem>
<listitem
><para>
  note: used to display a message
</para
></listitem>
</itemizedlist>

<para>

In &d-i; templates are stored in a readable file
<filename
>/var/cache/debconf/templates.dat</filename
>. This file contains all fixed
text and all translations. It can also contain a default value for the
template. The fixed text can include variables that will be replaced at
runtime.

</para
><para>

Another readable file <filename
>/var/cache/debconf/questions.dat</filename>
is used to store the values for variables and the answers given to questions.
A question always refers to the template used to ask it. For obvious
security reasons the values for questions of type <quote
>password</quote>
are stored in a separate, non-readable file in the same directory.

</para>
  </sect2>
-->
 </sect1>


 <sect1 id="preseed-using">
 <title
>Valmiiden vastausten käyttö</title>
<para
>Ensin on valmiit vastaukset sisältävä tiedosto tietenkin tehtävä ja tallennettava se paikkaan josta sitä halutaan käyttää. Tiedoston tekemistä käsitellään jäljempänä tässä liitteessä. Tallentaminen oikeaan paikkaan on varsin suoraviivaista käytettäessä verkkoa tai jos tiedosto halutaan lukea levykkeeltä tai USB-muistilta. Jos tiedosto halutaan tallentaa CD- tai DVD-levylle, on ISO-otos luotava uudelleen. Tiedoston saaminen mukaan initrd:hen ei kuulu tämän ohjeen piiriin; katso kehittäjän ohjeita Debianin asentimelle. </para
><para
>Valmiiden vastausten tiedostosta on esimerkki &urlset-example-preseed; jota voi käyttää oman tiedoston pohjana. Tuo tiedosto käyttää tämän liitteen esimerkkeinä olevia asetuksia. </para>

  <sect2 id="preseed-loading">
  <title
>Valmiiden vastausten tiedoston lataaminen</title>
<para
>Jos tallennuspaikkana on initrd, riittää varmistaa tiedoston nimeltä <filename
>preseed.cfg</filename
> olevan initrd:n juurihakemistossa. Asennin tarkistaa automaattisesti onko tuo tiedosto paikallaan ja lataa sen. </para
><para
>Tallennettaessa vastaukset muuanne on asentimelle kerrottava käynnistyksen yhteydessä mitä tiedostoa käytetätään. Tämä tehdään tavallisesti antamalla ytimelle käynnistysparametreja, joko käsin käynnistyksen yhteydessä tai muokkaamalla käynnistyslataimen asetustiedostoa (esim. <filename
>syslinux.cfg</filename
>) ja lisäämällä parametri ytimen append-rivin lopppuun. </para
><para
>Jos vastaukset sisältävä tiedosto kerrotaan käynnistyslataimen asetuksissa, halutaan asetuksia ehkä muuttaa siten ettei asenninta tarvitse käynnistää painamalla &enterkey;. Jos käytössä on syslinux asetetaan aikakatkaisun arvoksi <literal
>1</literal
> tiedostossa <filename
>syslinux.cfg</filename
>. </para
><para
>Tiedostolle on mahdollista asettaa tarkistussumma varmistamaan asentimen saavan oikean asetustiedoston. Tällä hetkellä tarkistussummman on oltava md5sum, ja jos se annetaan sen on vastattava valmiit vastaukset sisältävää tiedostoa tai asennin jättää tiedoston käyttämättä. </para>

<informalexample
><screen
>Käytettäviä käynnistysparametreja:
- jos käynnistetään verkosta:
  preseed/url=http://host/path/to/preseed.cfg
  preseed/url/checksum=5da499872becccfeda2c4872f9171c3d

- jos käynnistetään uudelleen luotu CD-levy:
  preseed/file=/cdrom/preseed.cfg
  preseed/file/checksum=5da499872becccfeda2c4872f9171c3d

- jos asennetaan USB-muistilta (tallenna valmiiden vastausten tiedosto USB-muistin juurihakemistoon):
  preseed/file=/hd-media/preseed.cfg
  preseed/file/checksum=5da499872becccfeda2c4872f9171c3d
</screen
></informalexample>

<para
>Huomaa, että <filename
>preseed/url</filename
> voidaan lyhentää <filename
>url</filename
> ja <filename
>preseed/file</filename
> lyhentää <filename
>file</filename
> kun niitä käytetään käynnistysparametreina. </para>
  </sect2>
  
  <sect2 id="preseed-bootparms">
  <title
>Annetaan valmiita vastauksia käynnistysparametreilla</title>
<para
>Jos valmiiden vastausten tiedostoa ei voi käyttää joidenkin vaiheiden automatisoimiseen, asennus voidaan siitä huolimatta automatisoida täysin, koska valmiit vastaukset voidaan välittää komentorivillä asenninta käynnistettäessä. </para
><para
>Käynnistysparametreja voidaan käyttää myös, jos ei varsinaisesti haluta käyttää valmiita vastauksia, vain antaa vastaus johonkin tiettyyn kysymykseen. Joitakin esimerkkejä tilanteista joissa tämä on hyödyllistä löytyy toisaalta tästä asennusohjeesta. </para
><para
>Debianin asentimessa käytettävän muuttujan arvo asetetaan kirjoittamalla <userinput
><replaceable
>polku/siihen/muuttujaan</replaceable
>=<replaceable
>arvo</replaceable
></userinput
> mille tahansa tämän liitteen esimerkeissä luetellulle valmiita vastauksia käyttävälle muuttujalle. Jos arvoa käytetään kohdejärjestämän pakettien asetusten tekemiseen, on alkuun lisättävä muuttujan <firstterm
>omistaja</firstterm
><footnote
> <para
>Debconf-muuttujan (tai mallineen) omistaja on tavallisesti sen paketin nimi, johon vastaava debconf-malline kuuluu. Asentimessa itsessään käytettyjen muuttujien omistaja on <quote
>d-i</quote
>. Mallineilla ja muuttujilla voi olla useita omistajia, tästä on apua päätettäessä voidaanko ne poistaa debconf-tietokannasta jos paketti poistetaan. </para
> </footnote
>, tähän tapaan: <userinput
><replaceable
>omistaja</replaceable
>:<replaceable
>polku/siihen/muuttujaan</replaceable
>=<replaceable
>arvo</replaceable
></userinput
>. Jos omistajaa ei anneta, muuttujan arvoa ei kopioida kohdejärjestelmän debconf-tietokantaan, ja sitä ei niin ollen käytetä tehtäessä paketin asetuksia. </para
><para
>Yleensä valmiiden vastausten antaminen tällä tavalla merkitsee, että kysymystä ei kysytä. Antaaksesi kysymykselle tietyn oletusarvon siten, että kysymys edelleen kysytään, käytä operaattoria <quote
>?=</quote
> normaalin <quote
>=</quote
> sijaan. Katso myös <xref linkend="preseed-seenflag"/>. </para
><para
>Joillain usein käynnistimen kehotteessa käytetyillä muuttujilla olevan lyhennysmerkintä. Jos lyhennysmerkintä on käytettävissä, sitä käytetään tämän liitteen esimerkeissä pitkän nimen tilalla. Erityisesti muuttujan <literal
>preseed/url</literal
> lyhennysmerkintä on <literal
>url</literal
>, mukana on myös hieman automaagisuutta mahdollistamaan lyhyempien urlien käyttö. Toinen esimerkki on lyhyt muoto <literal
>tasks</literal
>, joka tarkoittaa <literal
>tasksel:tasksel/first</literal
>. </para
><para
><quote
>--</quote
> saa erikoismerkityksen käynnistysparametreissa. Viimeisen <quote
>--</quote
> jälkeen tulevat ytimen parametrit voidaan kopioida asennetun järjestelmän käynnistyslataimen asetuksiin (jos asennin tukee niitä käynnistyslataimelle). Asennin suodattaa automaattisesti pois tunnistamansa parametrit (kuten valmiita vastauksia koskevat). </para>
<note
><para
>Nykyiset linux-ytimet (2.6.9 ja uudemmat) hyväksyvät enintään 32 komentorivin parametria ja 32 ympäristömuutujaa, joihin lasketaan mukaan asentimelle oletusarvona annetut muuttujat. Jos nämä numerot ylitetään, ydin kaatuu (crash). (Aikaisemmilla ytimillä nämä rajat olivat pienemmät.) </para
></note>
<para
>Useimmissa asennuksissa voidaan jotkin käynnistyslataimen asetustiedoston valitsimet, kuten <literal
>vga=normal</literal
>, turvallisesti poistaa. Näin enemmän parametreja valmiiden vastausten käyttöön. </para>
<note
><para
>Voi olla ettei käynnistyksen parametreille voi aina antaa arvoa jossa on tyhjämerkki, vaikka käytettäisiinkin lainausmerkkejä arvon ympärillä. </para
></note>
  </sect2>
  
  <sect2 id="preseed-auto">
  <title
>Auto mode</title>
<para
>Debianin asentimessa on useita ominaisuuksia, jotka yhdessä käytettynä saavat varsin yksinkertaisilla käynnistyskehotteen komentoriveillä aikaan mielivaltaisin mutkikkaita automatisoituja asennuksia. Tämä käy ilmi näistä muutamista esimerkeistä: <informalexample
><screen>
auto url=autoserver
</screen
></informalexample
> Tässä oletetaan käytössä olevan DHCP-palvelin, jonka antamilla asetuksilla asennettava kone saa  osoitteen <literal
>autoserver</literal
> DNS:ltä, mahdollisesti lisättyään loppuun paikallisen verkkoaluenimen jos DHCP sen kertoi. Jos komento annettiin verkossa, jossa verkkoaluenimi on <literal
>example.com</literal
>, ja DHCP:n asetukset ovat kohtuullisen järkevät, noudettaisiin valmiiden vastausten tiedosto osoitteesta <literal
>http://autoserver.example.com/d-i/&releasename;/./preseed.cfg</literal
>. </para
><para
>Tuon urlin viimeinen osa (<literal
>d-i/&releasename;/./preseed.cfg</literal
>) otetaan <literal
>auto-install/defaultroot</literal
>:sta. Oletusarvona tähän sisältyy hakemisto <literal
>&releasename;</literal
> jotta tulevat versiot voivat määrittää oman koodinimensä ja päivitys uudempaan versioon sujuu hallitusti. Osa <literal
>/./</literal
> merkitsee juurta josta myöhemmät polkunimet voivat aloittaa (käytettäväksi preseed/include:ssa ja preseed/run:ssa). Tämän avulla tiedostot voidaan määrittää joko kokonaisina URLeina, "/" alkavilla ja sillä ankkuroiduilla polkunimillä tai jopa suhteellisina niminä jotka alkavat viimeisimmän valmiiden vastausten tiedoston sijainnista. Tämän avulla voidaan rakentaa siirrettävämpiä komentotiedostoja, joissa kokonainen komentotiedostojen hierarkia voidaan siirtää uuteen paikkaan sitä rikkomatta, esimerkiksi kopioimalla tiedostot USB-muistille kun ne alunperin olivat webbipalvelimella. Jos tässä esimerkissä valmiiden vastausten tiedostossa asetetaan <literal
>preseed/run</literal
> arvoon <literal
>/scripts/late_command.sh</literal
>, noudetaan tiedosto osoitteesta <literal
>http://autoserver.example.com/d-i/&releasename;/./scripts/late_command.sh</literal
>. </para
><para
>Jos ei ole paikallisia DHCP- tai DNS-palvelimia, tai jos et halua käyttää oletuspolkua tiedostoon <filename
>preseed.cfg</filename
>, voit silti käyttää eksplisiittistä urlia, ja jos et käytä osaa <literal
>/./</literal
> se ankkuroidaan polun alkuun (ts. URL:n kolmanteen kauttaviivaan <literal
>/</literal
>). Seuraava esimerkki edellyttää mahdollisimman vähän tukea paikallisverkolta: <informalexample
><screen>
auto url=<replaceable
>http://192.168.1.2/polku/omaan/preseed.tiedostooni</replaceable>
</screen
></informalexample
> Tämä toimii seuraavasti: <itemizedlist spacing="compact">
<listitem
><para
>jos URL:stä puuttuu yhteyskäytäntö, oletetaan http, </para
></listitem>
<listitem
><para
>jos konenimen osuudessa ei ole pisteitä, siihen lisätään DHCP:ltä saatu verkkoaluenimi, ja </para
></listitem>
<listitem
><para
>jos konenimen jälkeen ei tule <literal
>/</literal
>-merkkejä, lisätään oletuspolku. </para
></listitem>
</itemizedlist>

</para
><para
>URLin lisäksi voidaan antaa asetuksia jotka eivät sinänsä vaikuta suoraan debianin asentimen toimintaan, mutta jotka voidaan välittää edelleen ladatussa valmiiden vastausten tiedostossa <literal
>preseed/run</literal
> -määritteillä annetuille komentotiedostoille. Tällä hetkellä ainoa esimerkki tästä on <literal
>auto-install/classes</literal
>, jolla on lyhennysmerkintä <literal
>classes</literal
>. Tätä voidaan käyttää näin: <informalexample
><screen>
auto url=<replaceable
>example.com</replaceable
> classes=<replaceable
>class_A;class_B</replaceable>
</screen
></informalexample
> Tässä class voi tarkoittaa esimerkiksi asennettavan järjestelmän tyyppiä tai käytettävää kotoistusta. </para
><para
>Tätä käsitettä voidaan tietenkin laajentaa, ja jos niin tehdään, on järkevää käyttää siihen auto-installin nimiavaruutta. Niinpä voisi olla <literal
>auto-install/style</literal
> jota sitten käytetään komentotiedostoissa. Jos on tarvetta tehdä tämmöistä, ole hyvä ja mainitse siitä postituslistalla <email
>debian-boot@lists.debian.org</email
>, jotta vältymme nimien yhteentörmäyksiltä, ja voimme ehkä lisätä lyhennysmerkinnän sinua varten. </para
><para
>Käynnistysnimiötä <literal
>auto</literal
> ei vielä ole määritelty kaikille prosessoriperheille. Sama vaikutus saadaan käyttämällä parametreja <literal
>auto=true priority=critical</literal
> yhtä aikaa ytimen komentorivillä. <literal
>auto</literal
> on lyhennysmerkintä <literal
>auto-install/enable</literal
>:lle ja vaikuttaa maa-asetuston ja näppäimistön kysymysten viivästämiseen kunnes niihin on saatu haettua valmiit vastaukset, kun taas <literal
>priority</literal
> on lyhennysmerkintä <literal
>debconf/priority</literal
>:lle ja sen asettaminen arvoon <literal
>critical</literal
> estää kaikkia alhaisemman prioriteetin kysymykset. </para
><para
>Lisää kiinnostavia parametreja asennuksen automatisointiin DHCP:tä käyttämällä: <literal
>interface=auto netcfg/dhcp_timeout=60</literal
>, joka saa tietokoneen käyttämään ensimmäistä kelvollista verkkoliitäntää ja odottamaan kauemmin vastausta DHCP-kyselyyn. </para>
<tip
><para
>Laaja esimerkki valmiiden vastausten käytöstä, mukana komentotiedostoja ja luokkia, löytyy <ulink url="http://hands.com/d-i/"
>kehittäjän verkkosivulta</ulink
>. Sieltä saatavat esimerkit näyttävät myös muita kivoja toimintoja joita saadaan valmiiden vastausten luovalla käytöllä. </para
></tip>
  </sect2>

  <sect2 id="preseed-aliases">
  <title
>Valmiiden vastausten yhteydessä hyödylliset lyhennysmerkinnät</title>
<para
>Seuraavat lyhennysmerkinnät saattavat olla hyödyllisiä käytettäessä (auto mode) valmiita vastauksia . </para>

<!-- Setting column width does not seem to work; use non-breaking spaces
     to separate columns a bit -->
<informaltable frame="none">
<tgroup cols="2"
><tbody>
<row
><entry
>auto</entry
><entry
>auto-install/enable</entry
></row>
<row
><entry
>classes</entry
><entry
>auto-install/classes</entry
></row>
<row
><entry
>fb</entry
><entry
>debian-installer/framebuffer</entry
></row>
<row
><entry
>locale</entry
><entry
>debian-installer/locale</entry
></row>
<row
><entry
>priority</entry
><entry
>debconf/priority</entry
></row>
<row
><entry
>tiedosto</entry
><entry
>preseed/file</entry
></row>
<row
><entry
>url</entry
><entry
>preseed/url</entry
></row>
<row
><entry
>interface</entry
><entry
>netcfg/choose_interface</entry
></row>
<row
><entry
>hostname&nbsp;&nbsp;&nbsp;</entry
><entry
>netcfg/get_hostname</entry
></row>
<row
><entry
>domain</entry
><entry
>netcfg/get_domain</entry
></row>
<row
><entry
>protocol</entry
><entry
>mirror/protocol</entry
></row>
<row
><entry
>suite</entry
><entry
>mirror/suite</entry
></row>
</tbody
></tgroup>
</informaltable>

  </sect2>
  
  <sect2 id="preseed-dhcp">
  <title
>DHCP-palvelin kertomaan mistä valmiiden vastausten tiedosto löytyy</title>
<para
>DHCP:täkin voi käyttää kertomaan mistä päin verkkoa valmiit vastaukset sisältävä tiedosto noudetaan. DHCP sallii tiedoston nimen välittämisen. Tämä on tavallisesti verkkokäynnistyksen tiedosto, mutta jos se näyttäisi olevan URL noutaa verkosta haettavia valmiita vastauksia tukeva asennustaltio tiedoston URL:n avulla ja käyttää sitä valmiiden vastausten tiedostona. Seuraava esimerkki näyttää miten tämä tehdään ISC DHCP -palvelimen version 3 <filename
>dhcpd.conf</filename
>-tiedostossa (Debianin paketti dhcp3-server).  </para>

<informalexample
><screen
>if substring (option vendor-class-identifier, 0, 3) = "d-i" {
    filename "http://host/preseed.cfg";
}
</screen
></informalexample>

<para
>Huomaa edeltävän esimerkin tarjoavat tätä tiedostonimeä vain DHCP-asiakkaille jotka ilmoittavat nimekseen "d-i", joten tämä ei vaikuta tavallisiin DHCP-asiakkaisiin, vain asentimeen. Toinen tapa on kirjoittaa teksti vain nimetyn koneen tietueeseen jolloin sitä ei taaskaan käytetä kaikkiin verkosta tapahtuviin asennuksiin. </para
><para
>DHCP:tä on hyvä käyttää kertomaan valmiit vastaukset vain verkkokohtaisiin kysymyksiin, kuten käytettävä Debian-asennuspalvelin. Näin verkkoa käyttävät asennukset saavat automaattisesti valittua hyvän asennuspalvelimen, mutta muut asennukset voidaan tehdä vuorovaikutteisesti. DHCP:n käyttö automatisoimaan Debianin asennus kokonaan olisi tehtävä vain harkitusti. </para>
  </sect2>
 </sect1>


 <sect1 id="preseed-creating">
 <title
>Valmiiden vastausten tiedoston tekeminen</title>
<para
>Valmiiden vastausten tiedosto on komennon <command
>debconf-set-selections</command
> käyttämässä muodossa. Tiedoston rivi on muotoa: <informalexample
><screen
>&lt;omistaja&gt; &lt;kysymyksen nimi&gt; &lt;kysymyksen tyyppi&gt; &lt;arvo&gt;
</screen
></informalexample>

</para
><para
>Valmiiden vastausten tiedostoa kirjoitettaessa olisi pidettävä mielessä muutamia sääntöjä. </para>

<itemizedlist>
<listitem
><para
>Kirjoita vain yksi välilyönti tai sarkainmerkki tyypin ja arvon väliin: kaikki muut tyhjätilamerkit katsotaan arvoon kuuluviksi. </para
></listitem>
<listitem
><para
>Rivi voidaan jakaa usealle riville kirjoittamalla kenoviiva (<quote
><literal
>\</literal
></quote
>) jatkorivin merkiksi. Hyvä kohta rivin jakamiseen on kysymyksen nimen jälkeen; huono kohta on tyypin ja arvon välissä. Jaetut rivit yhdistetään yhdeksi riviksi tiivistämällä edeltävät ja jälkeen tulevat tyhjätilamerkit yhdeksi välilyönniksi. </para
></listitem>
<listitem
><para
>Asentimessa itsessään käytettävien debconf-muuttujien (mallineiden) omistajaksi tulisi asettaa <quote
>d-i</quote
>; asennetun järjestelmän muuttujille arvoja annettaessa omistajaksi tulisi asettaa sen paketin nimi, jossa vastaava debconf-malline on.  </para
></listitem>
<listitem
><para
>Useimpiin kysymyksiin on valmis vastaus annettava englanninkielisenä arvona eikä käännettynä arvona. Joissakin kysymyksissä (esimerkiksi moduulissa <classname
>partman</classname
>) on kuitenkin käytettävä käännettyjä arvoja. </para
></listitem>
<listitem
><para
>Joihinkin kysymyksiin arvo on koodi eikä asennuksen aikana näytettävä teksti. </para
></listitem>
</itemizedlist>

<para
>Valmiiden vastausten tiedosto on helpointa tehdä esimerkkitiedostosta <xref linkend="preseed-contents"/> ja muokata sitä sopivaksi. </para
><para
>Toinen tapa on tehdä asennus tavalliseen tapaan ja sitten, uudelleenkäynnistyksen jälkeen, paketin <classname
>debconf-utils</classname
> komennolla <command
>debconf-get-selections</command
> vedostaa sekä debconf-tietokanta että asentimen debconf-tietokanta yhteen tiedostoon: <informalexample
><screen
>$ debconf-get-selections --installer &gt; <replaceable
>tiedosto</replaceable>
$ debconf-get-selections &gt;&gt; <replaceable
>tiedosto</replaceable
>
</screen
></informalexample>

</para
><para
>Tällä tavalla tehdyssä tiedostossa on kuitenkin muutamia kohtia joihin ei pitäisi antaa valmista vastausta, joten esimerkkitiedoston käyttö pohjana on parempi useimmille käyttäjille. </para>

<note
><para
>Tämä vedostamistapa toimii, koska asennuksen lopuksi asentimen cdebconf-tietokanta tallennetaan asennettuun järjestelmään tiedostoon <filename
>/var/log/installer/cdebconf</filename
>. Koska tietokanta saattaa sisältää salassapidettävää tietoa, on tiedoston lukuoikeus oletusarvona vain pääkäyttäjällä. </para
><para
>Hakemisto <filename
>/var/log/installer</filename
> ja kaikki sen tiedostot poistetaan järjestelmästä jos paketti <classname
>installation-report</classname
> poistetaan valitsimella purge. </para
></note>

<para
>Valmiiden vastausten mahdollisia arvoja näkee komennolla <command
>nano</command
> tutkimalla tiedostoa <filename
>/var/lib/cdebconf</filename
> asennuksen aikana. Tiedostosta <filename
>templates.dat</filename
> näkee tyhjät mallineet ja tiedostosta <filename
>questions.dat</filename
> tämänhetkiset arvot ja muuttujille sijoitetut arvot. </para
><para
>Valmiiden vastausten tiedoston kelvollisuuden voi tarkistaa ennen asennusta komennolla <command
>debconf-set-selections -c <replaceable
>preseed.cfg</replaceable
></command
>. </para>
 </sect1>


 <sect1 id="preseed-contents">
 <title
>Valmiiden vastausten tiedoston sisältö (julkaisulle &releasename;)</title>
<para
>Tässä liitteessä käytetyt asetustiedostojen osat ovat saatavilla myös esimerkkiasetustiedostona &urlset-example-preseed;. </para
><para
>Huomaa tämän esimerkin olevan tarkoitettu Intel x86-arkkitehtuurille tapahtuvaan asennukseen. Jos asennetaan jollekin muulle arkkitehtuurille, jotkin esimerkeistä (kuten näppäimistön valinta ja käynnistyslataimen asennus) eivät ehkä ole mielekkäitä ja ne on korvattava arkkitehtuurikohtaisilla debconfin asetuksilla. </para>
 
  <sect2 id="preseed-l10n">
  <title
>Kotoistus</title>
<para
>Valmiit vastaukset kotoistukseen toimivat vain jos vastausten tallennuspaikka on initrd. Muista tallennuspaikoista tiedosto ladataan vasta kun kysymykset on jo esitetty. </para
><para
>Lokaalin avulla voidaan määrätä sekä kieli että maa, ja parina voi olla mikä tahansa &d-i;:in tukema kieli ja tunnustettu valtio. Jos pari ei muodosta kunnollista lokaalia, asennin valitsee automaattisesti valitun kielen kanssa kelpaavan lokaalin. Lokaali annetaan käynnistysparametrina kirjoittamalla <userinput
>locale=<replaceable
>fi_FI</replaceable
></userinput
>. <informalexample role="example"
><screen
># Lokaali määrittää kielen ja maan.
d-i debian-installer/locale string fi_FI
</screen
></informalexample>

</para
><para
>Näppämistön asetuksissa valitaan näppäimistön arkkitehtuuri ja asettelu. Useimmissa tapauksissa oikea näppäimistön arkkitehtuuri on oletusarvona, joten se ei tavallisesti tarvitse valmista vastausta. &d-i;:in pitää tuntea näppäinasettelu valitulle näppäimistöarkkitehtuurille. <informalexample role="example"
><screen
># Näppäimistön valinta.
#d-i console-tools/archs select at
d-i console-keymaps-at/keymap select us
# Esimerkki muusta näppäimistön arkkitehtuurista
#d-i console-keymaps-usb/keymap select mac-usb-us
</screen
></informalexample>

</para
><para
>Näppäimistön asetukset ohitetaan antamalla kysymykseen <classname
>console-tools/archs</classname
> valmis vastaus <userinput
>skip-config</userinput
>. Tällöin ytimen näppäinasettelu jää käyttöön. </para>

<note
><para
>2.6-ytimien syötetason muutoksien seurauksena näppäinarkkitehtuuri on melkein poistunut käytöstä. 2.6-ytimille olisi tavallisesti valittava näppäinasetteluksi <quote
>PC</quote
> (<userinput
>at</userinput
>). </para
></note>
  </sect2>

  <sect2 id="preseed-network">
  <title
>Verkkoasetukset</title>
<para
>Valmiit vastaukset verkkoasetuksiin ei tietystikään toimi jos valmiiden vastausten tiedosto noudetaan verkosta. Mutta CD-levyltä tai USB-muistilta käynnistettäessä lataaminen on tosi näppärää. Noudettaessa valmiiden vastausten tiedostot verkosta, voidaan verkon asetukset antaa ytimen käynnistysparametreina. </para
><para
>Mikäli verkosta käynnistettäessä on valittava tietty verkkoliitäntä ennen valmiiden vastausten tiedoston noutamista verkosta, käytetään käynnistysparametria kuten <userinput
>interface=<replaceable
>eth1</replaceable
></userinput
>. </para
><para
>Vaikkakaan valmiit vastaukset verkon asetuksiin ei tavallisesti ole mahdollista noudettaessa valmiiden vastausten tiedosto verkosta (käytettäessä <quote
>preseed/url</quote
>), voidaan seuraavalla kikalla kiertää tämä rajoitus vaikkapa haluttaessa antaa kiinteä osoite verkkoliitännälle. Kikkailu tapahtuu pakottamalla verkon asetukset tehtäväksi uudelleen kun valmiiden vastausten tiedosto on ladattu tekemällä <quote
>preseed/run</quote
> -komentotiedosto jossa on seuraavat komennot: <informalexample
><screen
>killall.sh; netcfg
</screen
></informalexample>

</para
><para
>Seuraavat debconf-muuttujat vaikuttavat verkon asetuksiin. </para>

<informalexample role="example"
><screen
># netcfg valitsee liitännän jossa linkkivalo palaa, mikäli mahdollista.
# Tällöin ohitetaan luettelon näyttäminen jos liitäntöjä on 
# enemmmän kuin yksi.
d-i netcfg/choose_interface select auto

# Valitaankin tietty liitäntä:
#d-i netcfg/choose_interface select eth1

# Jos DHCP-palvelin on hidas ja asennin tekee aikakatkaisun sitä
# odotellessaan, tämä voi olla hyödyllistä.
#d-i netcfg/dhcp_timeout string 60

# Jos mielluummin tekee verkon asetukset itse, poistetaan kommenttimerkit
# seur. rivistä ja muutaman rivin päästä olevissa kiinteiden
# verkkoasetusten riveistä.
#d-i netcfg/disable_dhcp boolean true

# Jos valmiiden vastausten tiedoston on toimittava sekä DHCP-palvelimen
# kanssa että ilman, poistetaan kommenttimerkki seur. riveistä ja
# kiinteiden verkkoasetusten riveistä.
#d-i netcfg/dhcp_failed note
#d-i netcfg/dhcp_options select Configure network manually

# Kiinteät verkkoasetukset.
#d-i netcfg/get_nameservers string 192.168.1.1
#d-i netcfg/get_ipaddress string 192.168.1.42
#d-i netcfg/get_netmask string 255.255.255.0
#d-i netcfg/get_gateway string 192.168.1.1
#d-i netcfg/confirm_static boolean true

# DHCP-palvelimelta saadut konenimi ja verkkoaluenimi ovat etusijalla,
# mutta näiden arvojen antaminen estää kysymysten esittämisen,
# vaikkakin käytetään DHCP:n antamia arvoja.
d-i netcfg/get_hostname string unassigned-hostname
d-i netcfg/get_domain string unassigned-domain

# Ota inha WEP-avaimen valintaikkuna pois käytöstä.
d-i netcfg/wireless_wep string
# Pälli dhcp konenimi, joillain palveluntarjoajilla salasanan tapaisena.
#d-i netcfg/dhcp_hostname string radish

# Jos verkkoa muuta laitetta varten tarvitaan epävapaata laiteohjelmistoa,
# voidaan asetukset tehdä siten, että asennin aina yrittää sen lataamista
# näyttämättä kehotetta. Tai vaihtamalla arvoksi false estetään kysyminen.
#d-i hw-detect/load_firmware boolean true
</screen
></informalexample>

<para
>Huomaa komennon <command
>netcfg</command
> muodostavan verkon peiton automaattisesti jos muuttujalla <classname
>netcfg/get_netmask</classname
> ei ole valmista vastausta. Tässä tapauksessa muuttujalle on merkittävä <literal
>seen</literal
> automaattisissa asennuksissa. Samoin <command
>netcfg</command
> valitsee sopivan osoitteen jos <classname
>netcfg/get_gateway</classname
> on ilman arvoa. Erikoistapauksena <classname
>netcfg/get_gateway</classname
> voidaan asettaa arvoon <quote
>none</quote
> tarkoittamaan ettei reititintä pidä käyttää. </para>

  </sect2>

  <sect2 id="preseed-mirror">
  <title
>Asennuspalvelimen asetukset</title>
<para
>Käytettävästä asennustavasta riippuen asennuspalvelimelta voidaan noutaa lisää asentimen osia, asentaa peruskokoonpano ja tehdä tiedosto <filename
>/etc/apt/sources.list</filename
> asennettavaan järjestelmään. </para
><para
>Parametri <classname
>mirror/suite</classname
> kertoo mitä julkaisua käytetään asennuksessa. </para
><para
>Parametri <classname
>mirror/udeb/suite</classname
> kertoo mistä julkaisusta asentimen lisäosat noudetaan. Tästä parametrista on hyötyä vain jos osat tosiaan noudetaan verkosta ja sen on vastattava käytetyn asennustavan initrd:n tekemisessä käytettyä julkaisua. Oletusarvona <classname
>mirror/udeb/suite</classname
> on sama kuin <classname
>mirror/suite</classname
>. </para>

<informalexample role="example"
><screen
># Jos valitaan ftp, ei merkkijonolle mirror/country tarvitse antaa arvoa.
#d-i mirror/protocol string ftp
d-i mirror/country string manual
d-i mirror/http/hostname string &archive-mirror;
d-i mirror/http/directory string /debian
d-i mirror/http/proxy string

# Asennettava julkaisu
#d-i mirror/suite string testing
# Julkaisu, josta asentimen lisäosat noudetaan (valinnainen).
#d-i mirror/udeb/suite string testing
</screen
></informalexample>

  </sect2>

  <sect2 id="preseed-time">
  <title
>Kellon ja aikavyöhykkeen asetukset</title>

<informalexample role="example"
><screen
># Määrittää onko laitekello standardiajassa vai paikallisessa ajassa.
d-i clock-setup/utc boolean true

# Tämä voidaan asettaa mihin tahansa kelvolliseen ympäristömuuttujan
# $TZ arvoon; kelvolliset arvot löytyvät hakemistosta /usr/share/zoneinfo/.
d-i time/zone string Europe/Helsinki
# Määrittää käytetäänkö NTP:tä kellon asettamiseen asennuksen aikana.
d-i clock-setup/ntp boolean true
# Käytettävä aikapalvelin. Oletus on lähes aina sopiva.
#d-i clock-setup/ntp-server string ntp.esimerkki.fi
</screen
></informalexample>

  </sect2>

  <sect2 id="preseed-partman">
  <title
>Osiointi</title>
<para
>Valmiiden vastausten käyttämistä levyn osioinnissa rajoittaa se, mitä <classname
>partman-auto</classname
> tukee. Voidaan osioida joko levyllä jo oleva vapaa tila tai koko levy. Osioiden asettelu levyllä voidaan määrätä käyttämällä valmista mallinetta, muokattua mallinetta mallinetiedostosta tai valmiiden vastausten tiedostoon tallennettua mallinetta. Tällä hetkellä ei ole mahdollista käyttää valmiita vastauksia useiden levyjen osioimiseen. </para>

<warning
><para
>Levylaitteiden ajurien lataamisjärjestys vaikuttaa levyjen nimeämiseen. Jos järjestelmässä on useinta kiintolevyjä, varmistu huolellisesti oikean levyn tulevan valituksi valmiita vastauksia käytettäessä. </para
></warning>

<informalexample role="example"
><screen
># Jos järjestelmässä on vapaata tilaa voidaan valita osioitavaksi vain
# tuo tila. 
#d-i partman-auto/init_automatically_partition select biggest_free

# Toinen tapa on määrätä mikä levy osioidaan. Laitenimi voidaan antaa 
# joko devfs- tai perinteisessä ei-devfs-muodossa.
# Huomaa: levy on annettava, paitsi jos laitteessa on vain yksi levy.
# Esimerkiksi haluttaessa käyttää ensimmäistä SCSI/SATA-levyä:
#d-i partman-auto/disk string /dev/sda
# Lisäksi on määritettävä mitä osiointitapaa käytetään.
# Tällä hetkellä käytettävissä on tavat: "regular", "lvm" ja "crypto"
d-i partman-auto/method string lvm

# Jos yhdellä automaattisesti osioitavista levyistä on vanha LVM-asennus,
# saa käyttäjä tavallisesti varoituksen. Tämä varoitus voidaan 
# valmiilla vastauksella poistaa...
d-i partman-lvm/device_remove_lvm boolean true
# Samalla lailla ohjelmallisesti toteutetulle RAID-pakalle:
d-i partman-md/device_remove_md boolean true
#Vielä voidaan poistaa varmistuskysely lvm-osiolle kirjoittamisesta.
d-i partman-lvm/confirm boolean true

# Voidaan valita mikä tahansa ennalta määrätyistä osiointimallineista.
# - atomic: kaikki tiedostot yhdessä levyosiossa
# - home: erillinen /home -osio
# - multi: erilliset /home, /usr/, /var ja /tmp 
d-i partman-auto/choose_recipe select atomic

# Tai käytä omaa mallia...
# Mallin syntaksi on kuvattu tiedostossa devel/partman-auto-recipe.txt
# Jos mallitiedosto saadaan d-i:n saataville, siihen voidaan viitata suoraan.
#d-i partman-auto/expert_recipe_file string /hd-media/recipe

# Jos ei saada, voidaan koko malli pistää valmiiden vastausten tiedostoon
# yhtenä (loogisena) rivinä. Tämä esimerkki luo pienen /boot-osion,
# sopivan sivutusosion ja loput tilasta käytetään juuriosiona:
#d-i partman-auto/expert_recipe string                         \
#      boot-root ::                                            \
#              40 50 100 ext3                                  \
#                      $primary{ } $bootable{ }                \
#                      method{ format } format{ }              \
#                      use_filesystem{ } filesystem{ ext3 }    \
#                      mountpoint{ /boot }                     \
#              .                                               \
#              500 10000 1000000000 ext3                       \
#                      method{ format } format{ }              \
#                      use_filesystem{ } filesystem{ ext3 }    \
#                      mountpoint{ / }                         \
#              .                                               \
#              64 512 300% linux-swap                          \
#                      method{ swap } format{ }                \
#              .

# Tämä saa partman-moduulin tekemään osiot automaattisesti ilman
# varmistuksia, jos sille määritettiin yksi yllä olevista tavoista.
d-i partman/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
</screen
></informalexample>

  </sect2>

  <sect2 id="preseed-partman-raid">
  <title
>Osiointi käyttäen RAIDia</title>
<para
>Valmiilla vastauksilla voidaan tehdä osiot myös ohjelmallisesti toteutettuihin RAID-pakkoihin. Tuettuja ovat RAID-tasot 0, 1 ja 5, 6 ja 10, vajaiden pakkojen luominen ja varalevyjen määrittely. Käytettäessä RAID tasoa 1, voidaan valmiilla vastauksilla saada grub asentumaan kaikille pakassa käytetyille laitteille; katso <xref linkend="preseed-bootloader"/>. </para>

<warning
><para
>Tämänkaltaisen automaattisen osioinnin kanssa tekee helposti virheitä. Lisäksi toiminnallisuutta testataan &d-i;:in kehittäjien toimesta suhteellisen vähän. Vastuu mallineiden oikeellisuudesta (ovat järkeviä eivätkä sisällä ristiriitoja) on käyttäjällä. Tarkista lokitiedosto <filename
>/var/log/syslog</filename
> jos pulmia ilmenee. </para
></warning>

<informalexample
><screen
># HUOMIO: tämä valinta on laadultaan testiversio ja käytettävä varoen

# Mallineeksi olisi valittava "raid".
#d-i partman-auto/method string raid
# Määritä osioitavat levyt. Niihin tulee kaikkin sama osiointi,
# joten tämä toimii vain jos levyt ovat samankokoisia.
#d-i partman-auto/disk string /dev/discs/disc0/disc /dev/discs/disc1/disc

# Seuraavaksi on määritettävä käytettävä fyysinen osiointi.
#d-i partman-auto/expert_recipe string \
#      multiraid ::                                         \
#              1000 5000 4000 raid                          \
#                      $primary{ } method{ raid }           \
#              .                                            \
#              64 512 300% raid                             \
#                      method{ raid }                       \
#              .                                            \
#              500 10000 1000000000 raid                    \
#                      method{ raid }                       \
#              .

# Lopuksi on määritettävä kuinka yllä määriteltyjä osioita käytetään
# RAID-pakassa. Muista käyttää oikeita osioiden numeroita loogisille
# osioille.
# Parametrit ovat:
# &lt;raidtype&gt; &lt;devcount&gt; &lt;sparecount&gt; &lt;fstype&gt; &lt;mountpoint&gt; \
#          &lt;devices&gt; &lt;sparedevices&gt;
# RAID tasot 0, 1, 5, 6 ja 10 on tuettu; laitteiden erottimena on "#"
#d-i partman-auto-raid/recipe string \
#    1 2 0 ext3 /                                           \
#          /dev/discs/disc0/part1#/dev/discs/disc1/part1    \
#    .                                                      \
#    1 2 0 swap -                                           \
#          /dev/discs/disc0/part5#/dev/discs/disc1/part5    \
#    .                                                      \
#    0 2 0 ext3 /home                                       \
#          /dev/discs/disc0/part6#/dev/discs/disc1/part6    \
#    .

# Tämä saa partmanin tekemään osiot automaattisesti kysymättä vahvistusta.
d-i partman-md/confirm boolean true
d-i partman/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
</screen
></informalexample>

  </sect2>

  <sect2 id="preseed-base-installer">
  <title
>Perusjärjestelmän asennus</title>
<para
>Tässä asennuksen vaiheessa ei oikeastaan ole kovinkaan paljoa mahdollista käyttää valmiita vastauksia. Ainoat kysymykset koskevat ytimen asentamista. </para>

<informalexample role="example"
><screen
># Valitse initramfs:n tekevä ohjelma, jolla initrd tehdään 2.6-ytimille.
#d-i base-installer/kernel/linux/initramfs-generators string yaird
# Asennettava ydinkuvan sisältävä (meta)paketti. Valitse "none", jos
# mitään ydintä ei haluta asentaa.
#d-i base-installer/kernel/image string linux-image-2.6-486
</screen
></informalexample>

  </sect2>

  <sect2 id="preseed-account">
  <title
>Käyttäjätunnusten luonti</title>
<para
>Pääkäyttäjän tunnuksen root salasana ja ensimmäisen tavallisen käyttäjän tunnus ja salasana voidaan antaa valmiissa vastauksissa. Salasanalle voidaan käyttää joko ilmitekstiä tai MD5 <emphasis
>tiivistettä</emphasis
> (hash). </para>
<warning
><para
>On hyvä tietää ettei valmiiden vastausten käyttäminen salasanoille ole täysin tietoturvallista, koska jokainen vastaukset sisältävän tiedoston lukija saa ne tietää. MD5-tiivisteiden käyttö parantaa turvallisuutta hieman, mutta saattaa myös tuudittaa liialliseen turvallisuuden tunteeseen koska MD5-tiivisteen tietämällä voi salasanoja murtaa kokeilemalla kaikki mahdollisuudet. </para
></warning>

<informalexample role="example"
><screen
># Ohita pääkäyttäjän tunnuksen luominen (tavallinen käyttäjätunnus
# voi käyttää sudo:a).
#d-i passwd/root-login boolean false
# Tai ohita tavallisen käyttäjän tunnuksen luominen.
#d-i passwd/make-user boolean false

# Pääkäyttäjän salasana, joko ilmitekstinä
#d-i passwd/root-password password r00tme
#d-i passwd/root-password-again password r00tme
# tai salattuna käyttäen MD5-tiivistettä.
#d-i passwd/root-password-crypted password [MD5 hash]

# Tavallisen käyttäjän tunnuksen luonti.
#d-i passwd/user-fullname string Debian User
#d-i passwd/username string debian
# Tavallisen käyttäjän salasana, joko ilmitekstinä
#d-i passwd/user-password password insecure
#d-i passwd/user-password-again password insecure
# tai salattuna käyttäen MD5-tiivistettä.
#d-i passwd/user-password-crypted password [MD5 hash]
# Luo ensimmäinen käyttäjä annetulla UID:llä oletuksen sijaan.
#d-i passwd/user-uid string 1010

# Käyttäjätunnus lisätään joihinkin standardeihin ryhmiin.
# Käytä tätä määrätäksesi itse ryhmät.
#d-i passwd/user-default-groups string audio cdrom video
</screen
></informalexample>

<para
>Muuttujille <classname
>passwd/root-password-crypted</classname
> ja <classname
>passwd/user-password-crypted</classname
> voidaan antaa valmis vastaus myös <quote
>!</quote
> arvona. Tällöin vastaavan käyttäjätunnuksen käyttö on estetty. Tämä voi olla kätevää pääkäyttäjän tunnukselle, tietenkin vain jos on tehty muu tapa tehdä pääkäyttäjä tehtävät tai kirjautua pääkäyttäjänä (esimerkiksi tunnistautua SSH-avaimilla tai komento <command
>sudo</command
>). </para
><para
>Seuraavalla komennolla saadaan tehtyä salasanan MD5-tiiviste: <informalexample
><screen
>$ echo "r00tme" | mkpasswd -s -m md5
</screen
></informalexample>

</para>
  </sect2>

  <sect2 id="preseed-apt">
  <title
>Apt:n asetukset</title>
<para
>Tiedoston <filename
>/etc/apt/sources.list</filename
> teko ja perusasetukset on täysin automatisoitu asennustavan ja aiempien kysymysten vastausten perusteella. Muiden (paikallisten) varastoalueiden lisääminen on valinnaista. </para>

<informalexample role="example"
><screen
># non-free- ja contrib-osastojen ohjelmia voidaan valita asennettaviksi.
#d-i apt-setup/non-free boolean true
#d-i apt-setup/contrib boolean true
# Poista kommenttimerkki, jos et halua käyttää asennuspalvelimen kopiota.
#d-i apt-setup/use_mirror boolean false
# Valitse käytettävät päivityspalvelut. Määritä käytettävät peilit.
# Alla olevat arvot ovat normaalit oletusarvot.
#d-i apt-setup/services-select multiselect security, volatile
#d-i apt-setup/security_host string security.debian.org
#d-i apt-setup/volatile_host string volatile.debian.org

# Lisää varastoja, local[0-9] käytettävissä
#d-i apt-setup/local0/repository string \
#       http://local.server/debian stable main
#d-i apt-setup/local0/comment string local server
# Ota käyttöön deb-src-rivit
#d-i apt-setup/local0/source boolean true
# Varaston julkisen avaimen URL. Avaimen on oltava käytettävissä
# tai apt valittaa tunnistamattomasta varastosta ja tiedoston
# sources.list rivi jää kommentoiduksi pois
#d-i apt-setup/local0/key string http://local.server/key

# Oletusarvona asennin vaatii varastojen autentikointia tunnetulla
# gpg-avaimella. Tällä asetuksella tuo autentikointi saadaan pois päältä.
# Varoitus: ei turvallinen, ei suositella.
#d-i debian-installer/allow_unauthenticated string true
</screen
></informalexample>

  </sect2>

  <sect2 id="preseed-pkgsel">
  <title
>Pakettien valinta</title>
<para
>Asennettavaksi voidaan valita mitkä tahansa saatavilla olevista tehtävistä. Tätä kirjoitettaessa saatavilla olevia tehtäviä ovat ainakin: </para>

<itemizedlist>
<listitem
><para>
  <userinput
>standard</userinput>
</para
></listitem>
<listitem
><para>
  <userinput
>desktop</userinput>
</para
></listitem>
<listitem
><para>
  <userinput
>gnome-desktop</userinput>
</para
></listitem>
<listitem
><para>
  <userinput
>kde-desktop</userinput>
</para
></listitem>
<listitem
><para>
  <userinput
>web-server</userinput>
</para
></listitem>
<listitem
><para>
  <userinput
>print-server</userinput>
</para
></listitem>
<listitem
><para>
  <userinput
>dns-server</userinput>
</para
></listitem>
<listitem
><para>
  <userinput
>file-server</userinput>
</para
></listitem>
<listitem
><para>
  <userinput
>mail-server</userinput>
</para
></listitem>
<listitem
><para>
  <userinput
>sql-database</userinput>
</para
></listitem>
<listitem
><para>
  <userinput
>laptop</userinput>
</para
></listitem>
</itemizedlist>

<para
>Voidaan myös jättää kaikki tehtävät valitsematta, ja pakotetaan halutun pakettijoukon asennus muilla tavoin. Suositellaan aina valittavaksi tehtävä <userinput
>standard</userinput
>. </para
><para
>Jos tehtävien asentamien pakettien lisäksi halutaan asentaa yksittäisiä paketteja, voidaan käyttää parametria <classname
>pkgsel/include</classname
>. Tämän parametrin arvona voi olla luettelo paketteja eroteltuna joko pilkuin tai välilyönnein, joten sitä on helppo käyttää ytimen käynnistysparametrinakin. </para>

<informalexample role="example"
><screen
>tasksel tasksel/first multiselect standard, web-server
# Jos tehtävä "desktop" on valittuna, asennetaan kde- ja xfce-työpöydät
# oletusarvoisen gnome-työpöydän sijaan.
#tasksel tasksel/desktop multiselect kde, xfce

# Asennetaan yksittäisiä lisäpaketteja
#d-i pkgsel/include string openssh-server build-essential
# Päivitetäänkö paketit debootstrapin jälkeen.
# Sallitus arvot: none, safe-upgrade, full-upgrade
#d-i pkgsel/upgrade select none

# Eräät asentimen versiot voivat kertoa mitä ohjelmia on asennettuna
# ja mitä ohjelmia käytetään. Oletusarvo on, ettei raporttia lähetetä,
# mutta raporttien lähettäminen auttaa Debian-projektia tietämään
# suosituimmat ohjelmat ja kokoamaan ne CD-levyille.
#popularity-contest popularity-contest/participate boolean false
</screen
></informalexample>

  </sect2>

  <sect2 id="preseed-bootloader">
  <title
>Käynnistyslataimen asennus</title>

<informalexample role="example"
><screen
># Grub on oletus käynnistyslataimeksi (arkkitehtuurille x86). Jos sen
# tilalle halutaan lilo, poista tästä kommentit:
#d-i grub-installer/skip boolean true
# Ohittaaksesi myös lilon asennuksen, jolloin mitään käynnistyslatainta
# ei asenneta, poista myös tästä kommentit:
#d-i lilo-installer/skip boolean true

# Tämä on melko turvallinen asetus. Se asentaa grubin automaattisesti
# MBR:ään, jos koneesta ei löydy muita käyttöjärjestelmiä.
d-i grub-installer/only_debian boolean true

# Tämä saa grub-installerin asentamaan MBR:ään, jos se löytää jonkin muun
# käyttöjärjestelmän. Turvattomampaa, koska toista ehkä osata käynnistää.
d-i grub-installer/with_other_os boolean true

# Jos halutaan asentaa muualle kuin MBR:ään, poista kommentti ja muokkaa
# näitä rivejä:
#d-i grub-installer/only_debian boolean false
#d-i grub-installer/with_other_os boolean false
#d-i grub-installer/bootdev  string (hd0,0)
# Asennetaan grub usealle levylle:
#d-i grub-installer/bootdev  string (hd0,0) (hd1,0) (hd2,0)

# Grubin valinnainen salasana, joko selväkielisenä
#d-i grub-installer/password password r00tme
#d-i grub-installer/password-again password r00tme
# tai salattuna MD5 tiivisteenä, katso grub-md5-crypt(8).
#d-i grub-installer/password-crypted password [MD5 hash]
</screen
></informalexample>

<para
>Salasanalle voidaan tehdä MD5-tiiviste <classname
>grub</classname
>:ia varten komennolla <command
>grub-md5-crypt</command
>, tai käyttämällä komentoa esimerkistä <xref linkend="preseed-account"/>. </para>
  </sect2>

  <sect2 id="preseed-finish">
  <title
>Asennuksen lopetus</title>

<informalexample role="example"
><screen
># Asennettaessa sarjaväylän konsolilta ovat tavalliset virtuaalikonsolit
# (VT1-VT6) poistettu käytöstä tiedostossa /etc/inittab. Poista
# kommentti seuraavilta riveiltä jos virtuaalikonsolit halutaan käyttöön.
#d-i finish-install/keep-consoles boolean true

# Vältetään viimeinen viesti asennuksen valmistumisesta.
d-i finish-install/reboot_in_progress note

# Tämä estää asenninta poistamasta CD-levyä asemasta käynnistettäessä
# järjestelmää uudelleen, mikä on hyödyllistä joissakin tilanteissa.
#d-i cdrom-detect/eject boolean false

#Tällä tavalla asennin lopettaa kun on valmista, mutta ei käynnistä
#asennettua järjestelmää.
#d-i debian-installer/exit/halt boolean true
# Tämän avulla saadaan asennin sammuttamaan virta koneesta asennuksen
# valmistuttua, eikä vain sammuttamaan käyttöjärjestelmää (halt).
#d-i debian-installer/exit/poweroff boolean true
</screen
></informalexample>

  </sect2>

  <sect2 id="preseed-other">
  <title
>Valmiit vastaukset muille paketeille</title>

<informalexample role="example"
><screen
># Asennettaviksi valitut ohjelmat tai asennuksen meneminen pieleen 
# vaikuttavat kysyttäviin kysymyksiin. Muitakin kysymyksiä voi olla, 
# ja niihinkin voi antaa valmiit vastaukset. Kaikkien mahdollisten
# asennuksen aikana kysyttävien kysymysten luettelon saa asennuksen
# jälkeen komennoilla:
#   debconf-get-selections --installer 
> file
#   debconf-get-selections 
>
> file
</screen
></informalexample>

  </sect2>
 </sect1>


 <sect1 id="preseed-advanced">
 <title
>Lisäasetukset</title>

  <sect2 id="preseed-hooks">
  <title
>Mielivaltaisten komentojen käynnistämien asennuksen aikana</title>
<para
>Valmiiden vastausten vallan mahtava ja joustava ominaisuus on komentojen tai komentotiedostojen suorittaminen tietyissä paikoissa asennuksen aikana. </para>

<informalexample role="example"
><screen
># valmiiden vastausten käyttö ei ole perusturvallista. Asentimessa 
# ei ole lainkaan tarkistuksia tahallisten puskurin ylivuotojen 
# tai muiden sen kaltaisten arvojan varalle. Käytä valmiiden
# vastausten tiedostoja vain luotettavista lähteistä! Jotta 
# tämä varmasti tulisi selväksi, ja koska tämä on usein hyödyllistä,
# näin voidaan käynnistää mikä tahansa komentotulkin komento 
# automaattisesti asentimesta.

# Tämä ensimmäinen komento suoritetaan mahdollisimman aikaisin, heti
# valmiiden vastausten tiedoston lukemisen jälkeen.
#d-i preseed/early_command string anna-install some-udeb

# Tämä komento suoritetaan juuri ennen asennuksen päättymistä, mutta
# /target hakemiston vielä ollessa kunnossa. /target voidaan käyttää
# suoraan juurihakemistona tai käyttämällä komentoja apt-install ja
# in-target helposti asentaa paketteja ja suorittaa komentoja 
# asennetussa järjestelmässä.
#d-i preseed/late_command string apt-install zsh; in-target chsh -s /bin/zsh
</screen
></informalexample>

  </sect2>
  
  <sect2 id="preseed-seenflag">
  <title
>Oletusarvojen muuttaminen valmiilla vastauksilla</title>
<para
>Oletusarvoa on mahdollista muuttaa valmiilla vastauksella, siten, että kysymys silti esitetään. Tämä tehdään muuttamalla ilmaisimen <firstterm
>seen</firstterm
> arvoksi <quote
>false</quote
> sen jälkeen kun vastaus on asetettu. <informalexample
><screen>
d-i foo/bar string value
d-i foo/bar seen false
</screen
></informalexample
> Sama vaikutus <emphasis
>kaikille</emphasis
> kysymyksille saadaan asetuksella <classname
>preseed/interactive=true</classname
> käynnistyskehoitteessa. Tästä voi olla apua myös testattaessa tai jäljitettäessä vikaa valmiiden vastausten tiedostosta. </para
><para
>Jos valmiita vastauksia annetaan käynnistysparametreilla, saadaan asennin kysymään vastaava kysymys käyttämällä operaattoria <quote
>?=</quote
> eli <userinput
><replaceable
>foo</replaceable
>/<replaceable
>bar</replaceable
>?=<replaceable
>arvo</replaceable
></userinput
>. Tämä vaikuttaa tietenkin vain parametreihin, joita vastaa asennuksen aikana esitettävä kysymys, eikä sisäisiin (<quote
>internal</quote
>) parametreihin. </para
> 
  </sect2>

  <sect2 id="preseed-chainload">
  <title
>Valmiiden vastausten tiedostojen lataaminen ketjussa</title>
<para
>Valmiiden vastausten tiedostossa on mahdollista ottaa käyttöön muita tiedostoja. Noiden tiedostojen asetukset korvaavat aikaisemmin ladatuissa tiedostoissa olleet vastaavat arvot. Tämä mahdollistaa esimerkiksi yleisten paikallisten verkkoasetusten tallentaminen yhteen tiedostoon ja tarkemmat asetukset tiettyihin kokoonpanoihin toisiin tiedostoihin. </para>

<informalexample
><screen
># Luettelossa voi olla useita tiedostoja välilyönneillä eroteltuina;
# ne kaikki ladataan. Liitetyissä tiedostoissa voi olla myös omia 
# preseed/include-määreitä. Huomaa: jos tiedostonimet ovat suhteellisia,
# ne etsitään samasta hakemistosta kuin liittävä valmiiden vastausten
# tiedosto.
#d-i preseed/include string x.cfg

# Asennin tarkistaa haluttaessa valmiiden vastausten tiedostojen 
# tarkistussummat ennen tiedostojen käyttöä. Tällä hetkellä vain 
# md5sum on tuettu, luettele md5sum-arvot samassa järjestyksessä
# kuin liitettävien tiedostojen luettelo.
#d-i preseed/include/checksum string 5da499872becccfeda2c4872f9171c3d

# Joustavampi tapa: ajetaan komento komentotulkissa ja jos se
# tulostaa valmiiden vastausten tiedostojen nimiä, liitetään ne.
#d-i preseed/include_command \
#      string if [ "`hostname`" = bob ]; then echo bob.cfg; fi

# Kaikkein joustavin tapa: noudetaan ohjelma ja ajetaan se. Ohjelma
# voi käyttää komentoja kuten debconf-set muokatakseen debconf-tietokantaa.
# Komentotiedostoja voi olla useita, välilyönnein eroteltuna.
# Huomaa, että jos  tiedostonimet ovat suhteellisia, ne etsitään samasta 
# hakemistosta kuin ne käynnistävä valmiiden vastausten tiedosto
#d-i preseed/run string foo.sh
</screen
></informalexample>

<para
>Mahdollista on myös antaa verkkoasetusten valmiiden vastausten URL initrd:n tai tiedostojen valmiiden vastausten vaiheessa. Tällöin verkkoasetusten valmiit vastaukset käytetään kun verkko tulee käyttöön. Tätä tehtäessä on oltava varovainen, koska valmiita vastauksia käytetään kaksi erillistä kertaa, jolloin on esimerkiksi mahdollista suorittaa preseed/early-komento toiseen kertaan heti kun verkko on käytössä. </para>

  </sect2>
 </sect1>
</appendix>
<!--   End of file appendix/preseed.xml -->
